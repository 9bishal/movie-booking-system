{% extends "admin/base.html" %}
{% load static %}

{% block title %}{{ title }} | MovieBooking Admin{% endblock %}

{% block branding %}
<h1 id="site-name">
    <a href="{% url 'admin:index' %}">
        <!-- 
          WHY: Admin Logo.
          HOW: Using an emoji as a fallback/placeholder if the static image isn't configured, 
               keeping the interface clean and functional. 
        -->
        ðŸŽ¬ MovieBooking Admin
    </a>
</h1>
{% endblock %}

{% block extrastyle %}
<!-- 
  WHY: Custom Dashboard Styles.
  HOW: Inline styles used here to strictly scope them to the base_site override 
       without needing a separate CSS file for these specific header widgets.
-->
<style>
    :root {
        --primary: #4f46e5;
        --secondary: #10b981;
        --danger: #ef4444;
        --warning: #f59e0b;
        --dark: #1f2937;
    }
    
    #header {
        background: linear-gradient(135deg, var(--primary) 0%, #7c3aed 100%);
        color: white;
    }
    
    #branding h1 {
        color: white;
        font-weight: 600;
    }
    
    .module h2, .module caption, .inline-group h2 {
        background: linear-gradient(135deg, var(--primary) 0%, #7c3aed 100%);
    }
    
    .button, input[type=submit], input[type=button], .submit-row input, a.button {
        background: var(--primary);
        border-radius: 8px;
        transition: all 0.3s;
    }
    
    .button:hover, input[type=submit]:hover, input[type=button]:hover {
        background: #4338ca;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
    }
    
    .dashboard-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin: 20px 0;
    }
    
    .stat-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        border: 1px solid #e5e7eb;
        transition: transform 0.3s;
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
    }
    
    .stat-value {
        font-size: 2rem;
        font-weight: 700;
        margin: 10px 0;
    }
    
    .stat-growth {
        display: inline-flex;
        align-items: center;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.875rem;
        font-weight: 500;
    }
    
    .growth-up {
        background: #d1fae5;
        color: #065f46;
    }
    
    .growth-down {
        background: #fee2e2;
        color: #991b1b;
    }
    
    .quick-actions {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin: 20px 0;
    }
    
    .action-btn {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px;
        background: white;
        border-radius: 12px;
        text-decoration: none;
        color: var(--dark);
        border: 2px solid #e5e7eb;
        transition: all 0.3s;
    }
    
    .action-btn:hover {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
        transform: scale(1.05);
    }
    
    .action-btn i {
        font-size: 2rem;
        margin-bottom: 10px;
    }
    
    /* Utility Helpers */
    .text-muted { color: #6b7280; }
    .text-success { color: #10b981; }
    .text-primary { color: #4f46e5; }
    .text-warning { color: #f59e0b; }
    .text-info { color: #3b82f6; }
    .me-1 { margin-right: 0.25rem; }
    .small { font-size: 0.875rem; }
</style>
<!-- Load FontAwesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
{% endblock %}

{% block nav-global %}
{% if admin_stats %}
<!-- 
  WHY: Global Admin Stats.
  HOW: Injected via context_processor.admin_stats.
  WHEN: Visible on every admin page to keep staff informed.
-->
<div class="dashboard-stats" style="padding: 0 10px;">
    <!-- Revenue Card -->
    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <small class="text-muted" style="font-weight: 600;">TODAY'S REVENUE</small>
                <div class="stat-value text-success">â‚¹{{ admin_stats.revenue_today|default:0 }}</div>
            </div>
            {% if admin_stats.revenue_growth > 0 %}
            <span class="stat-growth growth-up">
                <i class="fas fa-arrow-up me-1"></i>{{ admin_stats.revenue_growth }}%
            </span>
            {% elif admin_stats.revenue_growth < 0 %}
            <span class="stat-growth growth-down">
                <i class="fas fa-arrow-down me-1"></i>{{ admin_stats.revenue_growth }}%
            </span>
            {% endif %}
        </div>
        <div class="text-muted small">Yesterday: â‚¹{{ admin_stats.revenue_yesterday|default:0 }}</div>
    </div>
    
    <!-- Bookings Card -->
    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <small class="text-muted" style="font-weight: 600;">TODAY'S BOOKINGS</small>
                <div class="stat-value text-primary">{{ admin_stats.total_bookings_today }}</div>
            </div>
            {% if admin_stats.booking_growth > 0 %}
            <span class="stat-growth growth-up">
                <i class="fas fa-arrow-up me-1"></i>{{ admin_stats.booking_growth }}%
            </span>
            {% elif admin_stats.booking_growth < 0 %}
            <span class="stat-growth growth-down">
                <i class="fas fa-arrow-down me-1"></i>{{ admin_stats.booking_growth }}%
            </span>
            {% endif %}
        </div>
        <div class="text-muted small">Yesterday: {{ admin_stats.total_bookings_yesterday }}</div>
    </div>
    
    <!-- Users Card -->
    <div class="stat-card">
        <small class="text-muted" style="font-weight: 600;">ACTIVE USERS</small>
        <div class="stat-value text-warning">{{ admin_stats.total_users }}</div>
        <div class="text-muted small">{{ admin_stats.new_users_today }} new today</div>
    </div>
    
    <!-- Showtimes Card -->
    <div class="stat-card">
        <small class="text-muted" style="font-weight: 600;">ACTIVE SHOWTIMES</small>
        <div class="stat-value text-info">{{ admin_stats.active_showtimes }}</div>
        <div class="text-muted small">{{ admin_stats.total_movies }} movies</div>
    </div>
</div>

<!-- 
  WHY: Quick Actions Bar.
  HOW: Direct links to commonly used admin actions.
-->
<div class="quick-actions" style="padding: 0 10px;">
    <a href="{% url 'admin:movies_movie_add' %}" class="action-btn">
        <i class="fas fa-plus-circle"></i>
        <span>Add Movie</span>
    </a>
    <a href="{% url 'admin:movies_showtime_add' %}" class="action-btn">
        <i class="fas fa-clock"></i>
        <span>Add Showtime</span>
    </a>
    <a href="{% url 'admin:bookings_booking_changelist' %}" class="action-btn">
        <i class="fas fa-ticket-alt"></i>
        <span>View Bookings</span>
    </a>
    <a href="{% url 'analytics_dashboard' %}" class="action-btn">
        <i class="fas fa-chart-bar"></i>
        <span>Analytics Dashboard</span>
    </a>
    <a href="{% url 'export_revenue_report' %}" class="action-btn">
        <i class="fas fa-file-export"></i>
        <span>Report</span>
    </a>
</div>
{% endif %}
{% endblock %}