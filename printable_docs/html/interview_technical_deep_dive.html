<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Technical Deep Dive - Movie Booking System</title>
    <style>
        /* Screen Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Georgia', 'Times New Roman', serif;
            line-height: 1.8;
            color: #000;
            background: #f5f5f5;
            padding: 20px;
            font-size: 12pt;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 8px;
        }
        
        .header {
            border-bottom: 3px solid #007bff;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #007bff;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #666;
            font-size: 1.1em;
        }
        
        .meta {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .meta-info {
            color: #666;
            font-size: 0.9em;
        }
        
        .actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .content {
            margin-top: 30px;
        }
        
        h1, h2, h3, h4, h5, h6 {
            margin-top: 1.5em;
            margin-bottom: 0.5em;
            color: #2c3e50;
        }
        
        h1 { font-size: 2em; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
        h2 { font-size: 1.75em; border-bottom: 1px solid #dee2e6; padding-bottom: 8px; }
        h3 { font-size: 1.5em; }
        h4 { font-size: 1.25em; }
        
        p {
            margin-bottom: 1em;
        }
        
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 10pt;
            color: #000;
            font-weight: 500;
        }
        
        pre {
            background: #f8f8f8;
            color: #000;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow-x: auto;
            margin: 15px 0;
            line-height: 1.6;
            font-size: 10pt;
        }
        
        pre code {
            background: none;
            color: #000;
            padding: 0;
            border: none;
            font-size: 10pt;
            font-weight: normal;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        table th, table td {
            padding: 12px;
            text-align: left;
            border: 1px solid #dee2e6;
        }
        
        table th {
            background: #007bff;
            color: white;
            font-weight: 600;
        }
        
        table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        blockquote {
            border-left: 4px solid #007bff;
            padding-left: 20px;
            margin: 20px 0;
            color: #666;
            font-style: italic;
        }
        
        ul, ol {
            margin: 15px 0;
            padding-left: 30px;
        }
        
        li {
            margin: 5px 0;
        }
        
        a {
            color: #007bff;
            text-decoration: none;
        }
        
        a:hover {
            text-decoration: underline;
        }
        
        hr {
            border: none;
            border-top: 2px solid #dee2e6;
            margin: 30px 0;
        }
        
        /* Print Styles - Optimized for Black & White */
        @media print {
            @page {
                margin: 0.75in;
                size: A4;
            }
            
            body {
                background: white;
                padding: 0;
                color: #000;
                font-size: 11pt;
                line-height: 1.6;
            }
            
            .container {
                box-shadow: none;
                padding: 0;
                max-width: 100%;
            }
            
            .actions, .no-print {
                display: none !important;
            }
            
            .header {
                border-bottom: 2px solid #000;
                padding-bottom: 10pt;
                margin-bottom: 15pt;
            }
            
            .header h1 {
                color: #000;
                font-size: 18pt;
            }
            
            .header p {
                color: #333;
                font-size: 11pt;
            }
            
            .meta {
                background: #f9f9f9;
                border: 1px solid #ddd;
                padding: 10pt;
                margin-bottom: 15pt;
            }
            
            h1 {
                font-size: 16pt;
                border-bottom: 2px solid #000;
                padding-bottom: 5pt;
                margin-top: 20pt;
                margin-bottom: 10pt;
                page-break-after: avoid;
            }
            
            h2 {
                font-size: 14pt;
                border-bottom: 1px solid #666;
                padding-bottom: 4pt;
                margin-top: 15pt;
                margin-bottom: 8pt;
                page-break-after: avoid;
            }
            
            h3 {
                font-size: 13pt;
                margin-top: 12pt;
                margin-bottom: 6pt;
                page-break-after: avoid;
            }
            
            h4 {
                font-size: 12pt;
                margin-top: 10pt;
                margin-bottom: 5pt;
                page-break-after: avoid;
            }
            
            p {
                margin-bottom: 8pt;
                orphans: 3;
                widows: 3;
            }
            
            /* Code blocks - BLACK & WHITE optimized */
            code {
                background: #f0f0f0;
                border: 1px solid #999;
                padding: 2pt 4pt;
                font-family: 'Courier New', 'Consolas', monospace;
                font-size: 9pt;
                color: #000;
                font-weight: 600;
            }
            
            pre {
                background: #f8f8f8;
                border: 2px solid #666;
                padding: 10pt;
                margin: 10pt 0;
                page-break-inside: avoid;
                font-size: 9pt;
                line-height: 1.4;
                overflow: visible;
                white-space: pre-wrap;
                word-wrap: break-word;
            }
            
            pre code {
                background: none;
                border: none;
                padding: 0;
                font-size: 9pt;
                font-weight: normal;
                color: #000;
            }
            
            /* Tables - BLACK & WHITE optimized */
            table {
                page-break-inside: avoid;
                border-collapse: collapse;
                width: 100%;
                margin: 10pt 0;
                border: 2px solid #000;
            }
            
            table th {
                background: #e0e0e0;
                color: #000;
                border: 1px solid #666;
                padding: 6pt;
                font-weight: bold;
                text-align: left;
            }
            
            table td {
                border: 1px solid #999;
                padding: 6pt;
                color: #000;
            }
            
            table tr:nth-child(even) {
                background: #f5f5f5;
            }
            
            /* Blockquotes */
            blockquote {
                border-left: 3px solid #000;
                padding-left: 10pt;
                margin: 10pt 0;
                font-style: italic;
                color: #333;
                page-break-inside: avoid;
            }
            
            /* Links */
            a {
                color: #000;
                text-decoration: underline;
            }
            
            a[href]:after {
                content: " (" attr(href) ")";
                font-size: 9pt;
                color: #666;
            }
            
            /* Lists */
            ul, ol {
                margin: 8pt 0;
                padding-left: 20pt;
            }
            
            li {
                margin: 4pt 0;
            }
            
            /* Horizontal rules */
            hr {
                border: none;
                border-top: 1px solid #000;
                margin: 15pt 0;
            }
            
            /* Image handling */
            img {
                max-width: 100%;
                page-break-inside: avoid;
            }
            
            /* Page breaks */
            .page-break {
                page-break-before: always;
            }
            
            /* Ensure visibility of all content */
            * {
                color: #000 !important;
                background: white !important;
            }
            
            code, pre {
                background: #f5f5f5 !important;
                border-color: #666 !important;
            }
            
            table th {
                background: #e0e0e0 !important;
            }
            
            table tr:nth-child(even) {
                background: #f8f8f8 !important;
            }
        }
        
        /* Code syntax highlighting */
        .codehilite .hll { background-color: #49483e }
        .codehilite .c { color: #75715e }
        .codehilite .k { color: #66d9ef }
        .codehilite .l { color: #ae81ff }
        .codehilite .n { color: #f8f8f2 }
        .codehilite .o { color: #f92672 }
        .codehilite .p { color: #f8f8f2 }
        .codehilite .cm { color: #75715e }
        .codehilite .cp { color: #75715e }
        .codehilite .c1 { color: #75715e }
        .codehilite .cs { color: #75715e }
        .codehilite .kc { color: #66d9ef }
        .codehilite .kd { color: #66d9ef }
        .codehilite .kn { color: #f92672 }
        .codehilite .kp { color: #66d9ef }
        .codehilite .kr { color: #66d9ef }
        .codehilite .kt { color: #66d9ef }
        .codehilite .ld { color: #e6db74 }
        .codehilite .m { color: #ae81ff }
        .codehilite .s { color: #e6db74 }
        .codehilite .na { color: #a6e22e }
        .codehilite .nb { color: #f8f8f2 }
        .codehilite .nc { color: #a6e22e }
        .codehilite .no { color: #66d9ef }
        .codehilite .nd { color: #a6e22e }
        .codehilite .ni { color: #f8f8f2 }
        .codehilite .ne { color: #a6e22e }
        .codehilite .nf { color: #a6e22e }
        .codehilite .nl { color: #f8f8f2 }
        .codehilite .nn { color: #f8f8f2 }
        .codehilite .nx { color: #a6e22e }
        .codehilite .py { color: #f8f8f2 }
        .codehilite .nt { color: #f92672 }
        .codehilite .nv { color: #f8f8f2 }
        .codehilite .ow { color: #f92672 }
        .codehilite .w { color: #f8f8f2 }
        .codehilite .mf { color: #ae81ff }
        .codehilite .mh { color: #ae81ff }
        .codehilite .mi { color: #ae81ff }
        .codehilite .mo { color: #ae81ff }
        .codehilite .sb { color: #e6db74 }
        .codehilite .sc { color: #e6db74 }
        .codehilite .sd { color: #e6db74 }
        .codehilite .s2 { color: #e6db74 }
        .codehilite .se { color: #ae81ff }
        .codehilite .sh { color: #e6db74 }
        .codehilite .si { color: #e6db74 }
        .codehilite .sx { color: #e6db74 }
        .codehilite .sr { color: #e6db74 }
        .codehilite .s1 { color: #e6db74 }
        .codehilite .ss { color: #e6db74 }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Technical Deep Dive</h1>
            <p>Advanced technical concepts and deep dive questions</p>
        </div>
        
        <div class="meta">
            <div class="meta-info">
                <strong>Generated:</strong> January 04, 2026<br>
                <strong>Source:</strong> interview/technical_deep_dive.md<br>
                <strong>Project:</strong> Movie Booking System
            </div>
            <div class="actions no-print">
                <button class="btn btn-primary" onclick="window.print()">
                    <span>üñ®Ô∏è</span> Print / Save as PDF
                </button>
                <button class="btn btn-success" onclick="downloadMarkdown()">
                    <span>üì•</span> Download Markdown
                </button>
                <a href="index.html" class="btn btn-secondary">
                    <span>üè†</span> Back to Index
                </a>
            </div>
        </div>
        
        <div class="content">
            <h1 id="technical-deep-dive-concurrency-payments-scalability">Technical Deep-Dive: Concurrency, Payments &amp; Scalability</h1>
<p>This document explains the &ldquo;Why, How, and When&rdquo; behind the core architectural decisions made in the movie booking system. It is designed to prepare you for technical interviews by explaining complex concepts like race conditions, distributed locking, and event-driven architecture.</p>
<hr />
<h2 id="the-race-condition-problem">üèéÔ∏è The &ldquo;Race Condition&rdquo; Problem</h2>
<p><strong>Q: What is a Race Condition in the context of movie booking?</strong><br />
<strong>A:</strong> Imagine two users, Alice and Bob, both looking at Seat A1 at the same time.</p>
<ol>
<li>Alice checks availability ‚Üí System says &ldquo;A1 is free&rdquo;.</li>
<li>Bob checks availability ‚Üí System says &ldquo;A1 is free&rdquo;.</li>
<li>Alice pays for A1.</li>
<li>Bob pays for A1.<br />
<strong>Result:</strong> Double Booking. This happens because the &ldquo;Check&rdquo; and &ldquo;Action&rdquo; are not connected in one atomic step.</li>
</ol>
<hr />
<h2 id="the-triple-shield-protection">üõ°Ô∏è The &ldquo;Triple-Shield&rdquo; Protection</h2>
<p><strong>Q: How does your system ensure &ldquo;Race-Condition Proof&rdquo; bookings?</strong><br />
<strong>A:</strong> We use a three-layered defense strategy:</p>
<h3 id="1-redis-optimistic-lock-the-traffic-controller">1. Redis Optimistic Lock (The Traffic Controller)</h3>
<ul>
<li><strong>Why:</strong> Database queries are slow. Redis is extremely fast (RAM-based).</li>
<li><strong>How:</strong> When a user selects seats, we create a <code>seat_reservation_{showtime}_{user}</code> key in Redis with a 10-minute TTL (Time To Live).</li>
<li><strong>When:</strong> Triggers during seat selection and again <em>during</em> the booking creation phase.</li>
</ul>
<h3 id="2-ui-live-synchronization-the-user-guard">2. UI Live Synchronization (The User Guard)</h3>
<ul>
<li><strong>Why:</strong> Users should never be surprised by a timeout.</li>
<li><strong>How:</strong> We pass the exact Redis TTL to the frontend. A JavaScript timer redirects the user the moment the lock expires.</li>
<li><strong>When:</strong> Active on the Booking Summary and Payment pages.</li>
</ul>
<h3 id="3-backend-authority-model-the-final-judge">3. Backend Authority Model (The Final Judge)</h3>
<ul>
<li><strong>Why:</strong> Razorpay modal might stay open longer than our Redis lock (Client-side control is never 100% reliable).</li>
<li><strong>How:</strong> In the <code>payment_success</code> view, we perform a <strong>Final Verification</strong>. We re-check the database for any new <code>CONFIRMED</code> bookings for those specific seats before issuing a ticket.</li>
<li><strong>When:</strong> Triggers <em>after</em> the money is captured but <em>before</em> the ticket is generated.</li>
</ul>
<hr />
<h2 id="redis-vs-database">üöÄ Redis vs. Database</h2>
<p><strong>Q: Why use Redis for seat locking instead of just the SQL database?</strong><br />
<strong>A:</strong></p>
<ul>
<li><strong>Latency:</strong> Redis responds in microseconds, ensuring the UI feels &ldquo;snappy&rdquo; during high-traffic sales.</li>
<li><strong>Auto-Expiry:</strong> Redis handles the cleanup for us. If a user abandons their cart, Redis automatically &ldquo;releases&rdquo; the seats when the TTL expires.</li>
<li><strong>Concurrency:</strong> Redis is single-threaded at its core, making it naturally gifted at handling atomic operations (like checking if a key exists and setting it in one go).</li>
</ul>
<hr />
<h2 id="celery-background-tasks">‚öôÔ∏è Celery &amp; Background Tasks</h2>
<p><strong>Q: Why do we use Celery for sending confirmation emails?</strong><br />
<strong>A:</strong></p>
<ul>
<li><strong>User Experience:</strong> Sending an email takes 2-3 seconds. If we did this &ldquo;in-process,&rdquo; the user would be stuck on a loading screen after paying.</li>
<li><strong>Resilience:</strong> If the email server is down, Celery can automatically retry the task later without affecting the main application.</li>
<li><strong>Scalability:</strong> We can have 100 users booking tickets simultaneously, and a separate &ldquo;Worker&rdquo; can handle the email queue in the background.</li>
</ul>
<hr />
<h2 id="razorpay-integration">üí≥ Razorpay Integration</h2>
<p><strong>Q: Why do we anchor the <code>razorpay_order_id</code> to the booking in our DB?</strong><br />
<strong>A:</strong> This prevents &ldquo;Payment Hijacking.&rdquo; If we didn&rsquo;t save the order ID, a malicious user could potentially capture a successful payment response from <em>another</em> transaction and try to apply it to a new booking. By anchoring the ID, we ensure the payment we receive is exactly for the booking we created.</p>
<hr />
<p>üé¨ <strong>Knowledge Check:</strong></p>
<blockquote>
<p>&ldquo;The goal of a robust system isn&rsquo;t just to make things work; it&rsquo;s to handle what happens when things fail, timeout, or collide.&rdquo;</p>
</blockquote>
        </div>
        
        <hr class="no-print">
        <div class="meta no-print" style="margin-top: 30px;">
            <p style="color: #666; font-size: 0.9em;">
                üí° <strong>Tip:</strong> Use <kbd>Ctrl+P</kbd> (Windows/Linux) or <kbd>Cmd+P</kbd> (Mac) to print or save as PDF.
                Select "Save as PDF" as your destination.
            </p>
        </div>
    </div>
    
    <script>
        // Download markdown function
        function downloadMarkdown() {
            const markdownContent = `# Technical Deep-Dive: Concurrency, Payments & Scalability\n\nThis document explains the "Why, How, and When" behind the core architectural decisions made in the movie booking system. It is designed to prepare you for technical interviews by explaining complex concepts like race conditions, distributed locking, and event-driven architecture.\n\n---\n\n## üèéÔ∏è The "Race Condition" Problem\n\n**Q: What is a Race Condition in the context of movie booking?**\n**A:** Imagine two users, Alice and Bob, both looking at Seat A1 at the same time.\n\n1. Alice checks availability ‚Üí System says "A1 is free".\n2. Bob checks availability ‚Üí System says "A1 is free".\n3. Alice pays for A1.\n4. Bob pays for A1.\n   **Result:** Double Booking. This happens because the "Check" and "Action" are not connected in one atomic step.\n\n---\n\n## üõ°Ô∏è The "Triple-Shield" Protection\n\n**Q: How does your system ensure "Race-Condition Proof" bookings?**\n**A:** We use a three-layered defense strategy:\n\n### 1. Redis Optimistic Lock (The Traffic Controller)\n\n- **Why:** Database queries are slow. Redis is extremely fast (RAM-based).\n- **How:** When a user selects seats, we create a \`seat_reservation_{showtime}_{user}\` key in Redis with a 10-minute TTL (Time To Live).\n- **When:** Triggers during seat selection and again _during_ the booking creation phase.\n\n### 2. UI Live Synchronization (The User Guard)\n\n- **Why:** Users should never be surprised by a timeout.\n- **How:** We pass the exact Redis TTL to the frontend. A JavaScript timer redirects the user the moment the lock expires.\n- **When:** Active on the Booking Summary and Payment pages.\n\n### 3. Backend Authority Model (The Final Judge)\n\n- **Why:** Razorpay modal might stay open longer than our Redis lock (Client-side control is never 100% reliable).\n- **How:** In the \`payment_success\` view, we perform a **Final Verification**. We re-check the database for any new \`CONFIRMED\` bookings for those specific seats before issuing a ticket.\n- **When:** Triggers _after_ the money is captured but _before_ the ticket is generated.\n\n---\n\n## üöÄ Redis vs. Database\n\n**Q: Why use Redis for seat locking instead of just the SQL database?**\n**A:**\n\n- **Latency:** Redis responds in microseconds, ensuring the UI feels "snappy" during high-traffic sales.\n- **Auto-Expiry:** Redis handles the cleanup for us. If a user abandons their cart, Redis automatically "releases" the seats when the TTL expires.\n- **Concurrency:** Redis is single-threaded at its core, making it naturally gifted at handling atomic operations (like checking if a key exists and setting it in one go).\n\n---\n\n## ‚öôÔ∏è Celery & Background Tasks\n\n**Q: Why do we use Celery for sending confirmation emails?**\n**A:**\n\n- **User Experience:** Sending an email takes 2-3 seconds. If we did this "in-process," the user would be stuck on a loading screen after paying.\n- **Resilience:** If the email server is down, Celery can automatically retry the task later without affecting the main application.\n- **Scalability:** We can have 100 users booking tickets simultaneously, and a separate "Worker" can handle the email queue in the background.\n\n---\n\n## üí≥ Razorpay Integration\n\n**Q: Why do we anchor the \`razorpay_order_id\` to the booking in our DB?**\n**A:** This prevents "Payment Hijacking." If we didn't save the order ID, a malicious user could potentially capture a successful payment response from _another_ transaction and try to apply it to a new booking. By anchoring the ID, we ensure the payment we receive is exactly for the booking we created.\n\n---\n\nüé¨ **Knowledge Check:**\n\n> "The goal of a robust system isn't just to make things work; it's to handle what happens when things fail, timeout, or collide."\n`;
            const blob = new Blob([markdownContent], { type: 'text/markdown' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'interview/technical_deep_dive.md';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }
        
        // Keyboard shortcut for print
        document.addEventListener('keydown', function(e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
                e.preventDefault();
                window.print();
            }
        });
    </script>
</body>
</html>
